# Командный проект 01 - Хранилище данных

## _Data Warehouse_

**Описание:** Изучение концепций хранилища данных (DWH) и создание первого ETL процесса.

## Изученные концепции

**Data Warehousing (DWH):**
Процесс сбора и управления данными из разрозненных источников для получения значимых бизнес-инсайтов.

**Два основных подхода к DWH:**

| Bill Inmon | Ralph Kimball |
|------------|---------------|
| "DWH - это предметно-ориентированная, интегрированная, неизменяемая и изменяющаяся во времени коллекция данных для поддержки управленческих решений" | "DWH - это система, которая извлекает, очищает, приводит в соответствие и доставляет исходные данные в многомерное хранилище данных" |

**Современная архитектура LakeHouse:**
LakeHouse = DataLake + DataWareHouse (основана на λ-архитектуре)

**Паттерны моделей данных:**
- Relational Model, Temporal Model, BiTemporal Model
- USS Model, EAV Model  
- Star/Snowflake Models, Galaxy Model
- Data Vault Model, Anchor Model, Graph Model

## Структура данных

**Источники данных (микросервисы):**
- **Green DB**: User (id, name, lastname)
- **Red DB**: Currency (id, name, rate_to_usd) 
- **Blue DB**: Balance (user_id, money, type, currency_id)

**DWH Database (временная модель):**
- Те же таблицы + атрибут `updated` (timestamp)
- Mocked Primary Key - дубликаты ID с разными временными метками
- Поддержка исторических изменений данных

**Аномалии данных:**
- Отсутствие консистентности между таблицами
- Возможные NULL значения
- Виртуальные внешние ключи между источниками

## Выполненные задания

- **00**: Классический DWH - агрегация транзакций по пользователям и типам балансов
- **01**: Детализированный запрос - расчет валютных курсов на основе временных меток

**Задание 00 - формулы расчета:**
- name/lastname: если NULL, то 'not defined'
- volume: сумма всех money по пользователю и типу
- currency_name: если NULL, то 'not defined'  
- last_rate_to_usd: последний курс валюты, если NULL то 1
- total_volume_in_usd: volume × last_rate_to_usd

**Задание 01 - логика временных курсов:**
- Найти ближайший курс в прошлом (t1)
- Если t1 пустой, найти ближайший курс в будущем (t2)
- Использовать t1 ИЛИ t2 для расчета в USD

## Технологии

- PostgreSQL
- ANSI SQL
- ETL процессы
- Временные модели данных
- Агрегация и группировка